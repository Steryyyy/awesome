local a=require("my.gears.matrix")local unpack=unpack or table.unpack;local b=math.atan2 or math.atan;local c=math.min;local d=math.cos;local e=math.sin;local f={}function f.star(g,h,i,j)local k=c(h,i)/2;j=j or 5;local l=2*math.pi/j;g:save()g:translate(h/2,i/2)g:rotate(-math.pi/2)for m=0,j-1 do g:line_to(k*d(m*l),k*e(m*l))g:line_to(k/2*d((m+0.5)*l),k/2*e((m+0.5)*l))end;g:restore()g:close_path()end;function f.rounded_rect(g,h,i,n)n=n or 10;if h/2<n then n=h/2 end;if i/2<n then n=i/2 end;g:move_to(0,n)g:arc(n,n,n,math.pi,3*math.pi/2)g:arc(h-n,n,n,3*math.pi/2,math.pi*2)g:arc(h-n,i-n,n,math.pi*2,math.pi/2)g:arc(n,i-n,n,math.pi/2,math.pi)g:close_path()end;function f.rounded_bar(g,h,i)f.rounded_rect(g,h,i,i/2)end;function f.partially_rounded_rect(g,h,i,o,p,q,r,s)s=s or 10;if h/2<s then s=h/2 end;if i/2<s then s=i/2 end;g:new_sub_path()if o then g:arc(s,s,s,math.pi,3*math.pi/2)else g:move_to(0,0)end;if p then g:arc(h-s,s,s,3*math.pi/2,math.pi*2)else g:line_to(h,0)end;if q then g:arc(h-s,i-s,s,math.pi*2,math.pi/2)else g:line_to(h,i)end;if r then g:arc(s,i-s,s,math.pi/2,math.pi)else g:line_to(0,i)end;g:close_path()end;function f.infobubble(g,h,i,t,u,v)u=u or 10;t=math.min((i-u)/2,t or 5)v=v or h/2-u/2;g:move_to(0,t+u)g:arc(t,t+u,t,math.pi,3*math.pi/2)g:line_to(v,u)g:line_to(v+u,0)g:line_to(v+2*u,u)g:arc(h-t,t+u,t,3*math.pi/2,math.pi*2)g:arc(h-t,i-t,t,math.pi*2,math.pi/2)g:arc(t,i-t,t,math.pi/2,math.pi)g:close_path()end;function f.rectangular_tag(g,h,i,w)w=w or i/2;if w>0 then g:move_to(0,i/2)g:line_to(w,0)g:line_to(h,0)g:line_to(h,i)g:line_to(w,i)else g:move_to(0,0)g:line_to(-w,i/2)g:line_to(0,i)g:line_to(h,i)g:line_to(h,0)end;g:close_path()end;function f.arrow(g,h,i,x,y,z)z=z or i/2;y=y or h/2;x=x or h;local A=i-z;g:move_to(h/2,0)g:rel_line_to(x/2,A)g:rel_line_to(-(x-y)/2,0)g:rel_line_to(0,z)g:rel_line_to(-y,0)g:rel_line_to(0,-z)g:rel_line_to(-(x-y)/2,0)g:close_path()end;function f.hexagon(g,h,i)g:move_to(i/2,0)g:line_to(h-i/2,0)g:line_to(h,i/2)g:line_to(h-i/2,i)g:line_to(i/2,i)g:line_to(0,i/2)g:line_to(i/2,0)g:close_path()end;function f.powerline(g,h,i,B)B=B or i/2;local C=0;if B<0 then h=h+2*B;C=-B end;g:move_to(C,0)g:line_to(C+h-B,0)g:line_to(C+h,i/2)g:line_to(C+h-B,i)g:line_to(C,i)g:line_to(C+B,i/2)g:close_path()end;function f.isosceles_triangle(g,h,i)g:move_to(h/2,0)g:line_to(h,i)g:line_to(0,i)g:close_path()end;function f.cross(g,h,i,D)D=D or h/3;local E=(h-D)/2;local F=(i-D)/2;g:move_to(E,0)g:line_to(h-E,0)g:line_to(h-E,F)g:line_to(h,F)g:line_to(h,i-F)g:line_to(h-E,i-F)g:line_to(h-E,i)g:line_to(E,i)g:line_to(E,i-F)g:line_to(0,i-F)g:line_to(0,F)g:line_to(E,F)g:close_path()end;function f.octogon(g,h,i,t)t=t or math.min(10,math.min(h,i)/4)local C=math.sqrt(t*t/2)g:move_to(C,0)g:line_to(h-C,0)g:line_to(h,C)g:line_to(h,i-C)g:line_to(h-C,i)g:line_to(C,i)g:line_to(0,i-C)g:line_to(0,C)g:close_path()end;function f.circle(g,h,i,n)n=n or math.min(h,i)/2;g:move_to(h/2+n,i/2)g:arc(h/2,i/2,n,0,2*math.pi)g:close_path()end;function f.rectangle(g,h,i)g:rectangle(0,0,h,i)end;function f.parallelogram(g,h,i,G)G=G or h/3;g:move_to(h-G,0)g:line_to(h,0)g:line_to(G,i)g:line_to(0,i)g:close_path()end;function f.losange(g,h,i)g:move_to(h/2,0)g:line_to(h,i/2)g:line_to(h/2,i)g:line_to(0,i/2)g:close_path()end;function f.pie(g,h,i,H,I,n)n=n or math.floor(math.min(h,i)/2)H,I=H or 0,I or math.pi/2;g:new_sub_path()if math.abs(H+I-2*math.pi)<=0.01 then g:arc(h/2,i/2,n,0,2*math.pi)else g:move_to(h/2,i/2)g:line_to(h/2+math.cos(H)*n,i/2+math.sin(H)*n)g:arc(h/2,i/2,n,H,I)end;g:close_path()end;function f.arc(g,h,i,D,H,I,J,K)H=H or 0;I=I or math.pi/2;g:new_sub_path()local n=math.min(h,i)/2;D=D or n/2;local L=n-D;local M=math.abs(I-H)/(2*math.pi)local N=(n-D/2)*2*math.pi*M;if J then N=N-D/2;H=I-N/(n-D/2)end;if K then N=N-D/2;I=H+math.max(0,N/(n-D/2))end;local O={h/2+math.cos(H)*n,i/2+math.sin(H)*n}if J then local P={h/2+math.cos(H)*L,i/2+math.sin(H)*L}local Q=b(P[1]-O[1],-(P[2]-O[2]))local R={(O[1]+P[1])/2,(O[2]+P[2])/2}g:arc(R[1],R[2],D/2,Q-math.pi/2,Q+math.pi/2)else g:move_to(unpack(O))end;g:arc(h/2,i/2,n,H,I)if K then local S={h/2+math.cos(I)*n,i/2+math.sin(I)*n}local T={h/2+math.cos(I)*L,i/2+math.sin(I)*L}local Q=b(T[1]-S[1],-(T[2]-S[2]))-math.pi;local R={(S[1]+T[1])/2,(S[2]+T[2])/2}g:arc(R[1],R[2],D/2,Q-math.pi/2,Q+math.pi/2)end;g:arc_negative(h/2,i/2,L,I,H)g:close_path()end;function f.radial_progress(g,U,V,W,X)W=W or 1;local Y=2*(U-V)+2*V/2*math.pi;local Z=(U-V)/Y;local M=V/2*math.pi/Y;if W>Z then g:move_to(V/2,V)g:line_to(V/2+U-V,V)g:stroke()elseif W<Z then g:move_to(V/2,V)g:line_to(V/2+Y*W,V)g:stroke()end;if W>=Z+M then g:arc(U-V/2,V/2,V/2,3*math.pi/2,math.pi/2)g:stroke()elseif W>Z and W<Z+M/2 then g:arc(U-V/2,V/2,V/2,math.pi/2-math.pi/2*(W-Z)/(M/2),math.pi/2)g:stroke()elseif W>=Z+M/2 and W<Z+M then g:arc(U-V/2,V/2,V/2,0,math.pi/2)g:stroke()local _=math.pi/2*(W-Z-M/2)/(M/2)g:arc(U-V/2,V/2,V/2,2*math.pi-_,0)g:stroke()end;if W>2*Z+M then g:move_to(V/2+U-V,0)g:line_to(V/2,0)g:stroke()elseif W>Z+M and W<2*Z+M then g:move_to(V/2+U-V,0)g:line_to(V/2+U-V-Y*(W-Z-M),0)g:stroke()end;if not X then if W>0.985 then g:arc(V/2,V/2,V/2,math.pi/2,3*math.pi/2)g:stroke()elseif W>2*Z+M then local a0=(W-2*Z-M)/M;g:arc(V/2,V/2,V/2,3*math.pi/2-math.pi*a0,3*math.pi/2)g:stroke()end end end;function f.transform(a1)local function a2(self,g,h,i,...)g:save()g:transform(self.matrix:to_cairo_matrix())a1(g,h,i,...)g:restore()end;local function a3(a4,a5)return function(self,...)self.matrix=self.matrix[a5](self.matrix,...)return self end end;local a6=setmetatable({matrix=a.identity},{__call=a2,__index=a3})return a6 end;return f